<html>
<head>
    <script src="./crypto-js.min.js"></script>
    <script src="./jquery.slim.min.js"></script>
	<link rel="stylesheet" type="text/css" href="./bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="./default.css" />
</head>
<body>

    <div class="main">
        <div class="hd-1">
        <span class="fw-semibold" style="color:#ffe600">VMess私人信息分享</span></a>
        </div>
          <ul class="tabs clearfix">
              <li class="selected">解密信息</li>
            <li>二维码生成器</li>
            <li>二维码解码器</li>
    
          </ul></br>	  
          <ul class="content clearfix">
          <li class="retrieve selected">
               
                        <div class="clearfix col-md-12">
                            <label for="secret">密钥(请输入本人的手机号-姓名 如韩梅梅的电话是13801234567，则密钥为：13801234567-hanmm )</label>
                            <div class="input"><input id="secret_key" class="text2style" style="background:#ccf2ff" rows="1"><button onclick="decrypt()" style="background:#ffcc66"><b>立即解密查看</b></button></div>
                        </br>
                </div>
    
                        <!-- /clearfix -->
                        <div class="clearfix col-md-12" style=""><textarea  id="decrypt_content" rows="30" cols="50"></textarea></div>
                        <br><br><br>
                        <div class="clearfix col-md-12" style="display: none;">
                            <textarea id="encrypt_content" rows="5" cols="50" placeholder="结果">U2FsdGVkX18/PA4g/xVbp8p8YBGSpOBUgkW0VNy9mRyQSye21lkfyNJbetHNWaFOGibCOh1RMGcQKkErm5WsS3J5VwpNzCZ4CL/Xgl+3kQnDvJ5OkGLuQKTbNMBwZILotgXuJOEpNd4bV7s+iJOitJcAKMkSdp1QV25+Kffwp2CfiLIwbMhbV5cGAAkdnv/VBGHybtXa9k8wksxpgEPYS8Y0DK1X0UM41OJBQSJ5LjWTsB+lfFBQqwkXL0qc8YpAc+hMLVcJIF6DaTgertleUYGw09H0ehjdLNItIotabvkXdBmHTv2smIOF8fERUGxfeevxGAGQXxc/YqtXmG5w2cVXswrYaHSeZADzzVgvnJ2NUCbUVyzYpk6L6bC2lN04tWPTGyLJmBjOhA1jyk1F5WXUMDpIX3F2vycpzbk94aFtXFoFD9RrxcnyhWa5A77kJt+VfjjSpGg15Ds5uwzPjXk7IqO/yKR5+MW3YsyxvZC3f4TRwQxvDm65SmEGOaeG+qVmCQXO2x7eTDPJYlWk5LIRY4QFjK1lX9xrODKnFxyVgra1TjNQC+kXMjMvXtNk2z/VMRJKYPx+A72v2ABsiaHBaHVSyeNQ93Hhyu+HBi0uo4MwMOT61WLRFFqmtsA/bncilnoHCMpz4obA179lujc85zfi80qjL2OniVWAPrnEsN0hTTfOVCZ9kKiNvA9msLHRG9W8Wa6cuiRLYvtELU3FHh4G6xlLEzQ1M9ykI1hGd1fIcXYzALqzdyzQwCJMYrlZtSIhKAanceGgQwN69BSu5FuV/uRBc9348mMBwDhSyRpw9dUkUvPV7kLAVc/F3DrQijCJsO1Ufb0QbZbLR2gAPG+tp1+Fxpx3XeHGaklhciItmuwvnbP9Pr2xQdmcmGkqKlQdXHcRnWtkE/7ADSWEGkCNMoRD1JbsBzg9ox8/xoqsCJg5eqPqukr3qMrB9HHvE8cY5gqSn+JUYuDwcpbxpmZyjqKAPaw/hHjNQLPYIqME3hQavmv+WHOQN/A59zLW3CrwkM1agVcUWu+n4fmpyE5DqQrKjTWzbIG9I8T403UhXkqgQguBqBMpOnUAQPqJdadL5knEbEfMCsWmcWvY1e3mM2tuaOEllzVjKGYtkh5SXOD8UruOIZkswkfmekmbZaodVKglL/az5kgdSmzL8/GlmKpGp2n0Nb5DR0POtqZnIS5Zy/GCiOzgCr0CHvUkHbxkdurRcsVemCDPcqGIKmW3UAEOF4clQc0zMVRyHYnRrGrsvsKnuIYdqZo6FlrRS2dD8yejFZvBnKD5Yc724mpwKOZjW2CugtImFi6xKu6oNszbgyBjq+ik4Vf6Wo0rqs0jM/BA0ZNH/F3e1eQaBGQDLYwnRDWRZygF8gtIliO/2dNLOOd11icVR1d64V4PLcDN894ylZVuOzkkHB3ucnMrBXK2cUg/m8RiVKOimJBpMbdW3my86thqne4W9IkwKNhCt7VCfzQy0GnBOkawadWEGlNe/o5/mGVGWtp96E/RO9GcXICRNuVE7YpX5dbJ1rEtbmVhjvVbr7Hk4gVwT2ecn2T20J9IREs6v1dmeBPXG++gfsYLInUidZGHbFakeaA+UgGLx41n3QUj6aQps9h5ZShBPzOMnk/qjsdiAHDDo0DF10r8MB/N9bp8v/OqdJ8uPbUo1ECnHHr+LySG1WuWKeH1vAJdmvxHK/gjL9gCncQ/QDVUzxZQaV4WBscQF8PtpEkA0ceGOCwGqmeavNv5xWVmhYgYidjVuQ06oZYD6XycW7uoskpttPunYx6/YT3/eLCAt7NPjS5exg==</textarea> <button onclick="encrypt()">加密</button>
                        </div>
            </li>
            
            <li class="encode">
              <p><label>二维码内容：</label></p>
              <div><textarea id="encode-text" style="background:#ccf2ff"></textarea></div>
              <p>
                <label>容错等级：</label>
                <select id="encode-eclevel" style="background:#ccf2ff">
                  <option value="L">低 (7%)</option>
                  <option value="M" selected>中 (15%)</option>
                  <option value="Q">正常 (25%)</option>
                  <option value="H">高 (30%)</option>
                </select>
                <label class="indent">支持 ECI：</label>
                <input id="encoding-hint" style="background:#ccf2ff" type="checkbox" />
                <label class="indent">编码格式：</label>
                <select id="encode-mode" style="background:#ccf2ff">
                  <option value="Auto" selected>自动</option>
                  <option value="QRByte">Byte</option>
                  <option value="QRAlphanumeric">Alphanumeric</option>
                  <option value="QRNumeric">Numeric</option>
                  <option value="QRKanji">Kanji</option>
                </select>
                <label class="indent">二维码大小：</label>
                <input id="encode-msize" style="background:#ccf2ff" type="number" min="1" max="10" value="4" />
                <label class="indent">白色背景大小：</label>
                <input id="encode-margin" style="background:#ccf2ff" type="number" min="0" max="40" value="12" />
              </p>
            
              <p>
                <button id="encode-btn" style="background:#ffcc66"><b>立即生成</b></button>
              </p>
              <div id="encode-result" class="encode-result hide"></div>
            </li>
            <li class="decode">
              <p><label>上传二维码图片：</label><input type="file" accept="image/*" id="decode-file"  style="background:#ffcc66" /></p>
              <div>
                <canvas id="decode-canvas"></canvas>
              </div>
        
              <p>
                <button id="decode-btn" style="background:#ffcc66"><b>解码二维码</b></button>
              </p>
              <p id="decode-text" class="hide"><b>解码内容：</b><br /><br /><b><textarea readonly class="text4style" style="background:#00ff00"></textarea></b></p>
            
            </li>
            
    </ul></br>
    
        </div>
        <script type="text/javascript" src="./qrcode.js"></script>
        <script type="text/javascript">
            // Tab Switch
            var nav = $('.tabs li');
            var content = $('.content li');
      
            nav.on('click', function () {
              var target = $(this);
      
              nav.removeClass('selected');
      
              target.addClass('selected');
      
              content.removeClass('selected').eq(target.index()).addClass('selected');
            });
            </script>

<script>
function encrypt() {
    var input = document.getElementById("encrypt_content").value;
    var key = document.getElementById("secret_key").value;
    var encrypted = CryptoJS.AES.encrypt(input, key);
    document.getElementById("decrypt_content").innerHTML = encrypted.toString();
}

function decrypt() {
    var encrypt_content = document.getElementById("encrypt_content").value;
    var key = document.getElementById("secret_key").value;
    var decrypted = CryptoJS.AES.decrypt(encrypt_content, key);
    document.getElementById("decrypt_content").innerHTML = decrypted.toString(CryptoJS.enc.Utf8);
}

if (document.getElementById("decrypt_content").innerHTML==''){
    document.getElementById("decrypt_content").innerHTML=document.getElementById("encrypt_content").value;
}


var TEST_NUMERIC = /^\d+$/;
      var TEST_ALPHANUMERIC = /^[0-9A-Z$%*+-./: ]+$/;

      function chooseBestModeData(data) {
        if (TEST_NUMERIC.test(data)) {
          return new QRCode.QRNumeric(data);
        } else if (TEST_ALPHANUMERIC.test(data)) {
          return new QRCode.QRAlphanumeric(data);
        }

        try {
          return new QRCode.QRKanji(data);
        } catch (error) {
          return new QRCode.QRByte(data);
        }
      }

      var encodeText = $('#encode-text');
      var encodeMode = $('#encode-mode');
      var encodingHint = $('#encoding-hint');
      var encodeECLevel = $('#encode-eclevel');
      var encodeMargin = $('#encode-margin');
      var encodeMSize = $('#encode-msize');
      var encodeResult = $('#encode-result');

      // Generate QR code
      $('#encode-btn').on('click', function () {
        var data = encodeText.val();
        var mode = encodeMode.val();
        var ecLevel = encodeECLevel.val();
        var margin = Number(encodeMargin.val());
        var moduleSize = Number(encodeMSize.val());
        var hasEncodingHint = encodingHint.prop('checked');

        if (!data) {
          encodeResult.addClass('hide');

          return alert('Please enter the content for generating the QR code');
        }

        var qrcode = new QRCode.Encoder();
        var errorCorrectionLevel = QRCode.ErrorCorrectionLevel[ecLevel];

        qrcode.setEncodingHint(hasEncodingHint).setErrorCorrectionLevel(errorCorrectionLevel);

        try {
          var data = mode === 'Auto' ? chooseBestModeData(data) : new QRCode[mode](data);

          qrcode.write(data).make();

          encodeResult.html('<img src="' + qrcode.toDataURL(moduleSize, margin) + '" />');
          encodeResult.removeClass('hide');

          console && console.log(qrcode);
        } catch (error) {
          encodeResult.addClass('hide');

          alert(error.message);
        }
      });

      var hasImage = false;
      var imageData = null;
      var decodeText = $('#decode-text');
      var canvas = $('#decode-canvas')[0];
      var context = canvas.getContext('2d');
      var decodeResult = decodeText.find('textarea');

      function resetDecoder() {
        hasImage = false;
        imageData = null;

        decodeResult.val('');
        decodeText.addClass('hide');
      }

      function drawImage(src) {
        var img = new Image();

        img.crossOrigin = 'anonymous';

        img.onload = function () {
          var width = img.width;
          var height = img.height;
          var actualWidth = Math.min(960, width);
          var actualHeight = height * (actualWidth / width);

          hasImage = true;
          canvas.width = actualWidth;
          canvas.height = actualHeight;

          context.drawImage(img, 0, 0, width, height, 0, 0, actualWidth, actualHeight);

          imageData = context.getImageData(0, 0, actualWidth, actualHeight);
        };

        img.src = src;
      }

      // QR code loading
      $('#decode-file').on('change', function (e) {
        var file = e.target.files[0];

        if (file) {
          resetDecoder();

          var reader = new FileReader();

          reader.onload = function (e) {
            drawImage(e.target.result);
          };

          reader.readAsDataURL(file);
        }
      });

      function getImageData() {
        imageData && context.putImageData(imageData, 0, 0);

        return imageData || context.getImageData(0, 0, canvas.width, canvas.height);
      }

      function getModuleSize(location, version) {
        var topLeft = location.topLeft;
        var topRight = location.topRight;
        var a = Math.abs(topRight.x - topLeft.x);
        var b = Math.abs(topRight.y - topLeft.y);
        var c = Math.sqrt(Math.pow(a, 2) + Math.pow(b, 2));

        return c / (version * 4 + 17);
      }

      function markFinderPattern(x, y, moduleSize) {
        context.fillStyle = '#00ff00';

        context.beginPath();
        context.arc(x, y, moduleSize * 0.75, 0, 2 * Math.PI);
        context.fill();
      }

      function markQRCodeArea(location, version) {
        context.lineWidth = 2;
        context.strokeStyle = '#00ff00';

        context.beginPath();
        context.moveTo(location.topLeft.x, location.topLeft.y);
        context.lineTo(location.topRight.x, location.topRight.y);
        context.lineTo(location.bottomRight.x, location.bottomRight.y);
        context.lineTo(location.bottomLeft.x, location.bottomLeft.y);
        context.lineTo(location.topLeft.x, location.topLeft.y);
        context.stroke();

        var moduleSize = getModuleSize(location, version);

        markFinderPattern(location.topLeftFinder.x, location.topLeftFinder.y, moduleSize);
        markFinderPattern(location.topRightFinder.x, location.topRightFinder.y, moduleSize);
        markFinderPattern(location.bottomLeftFinder.x, location.bottomLeftFinder.y, moduleSize);
      }

      $('#decode-btn').on('click', function () {
        if (!hasImage) {
          return alert('Please select a QR code image');
        }

        var imageData = getImageData();
        var result = new QRCode.Decoder()
          .setOptions({ canOverwriteImage: false })
          .decode(imageData.data, imageData.width, imageData.height);

        if (result) {
          decodeResult.val(result.data);
          decodeText.removeClass('hide');

          markQRCodeArea(result.location, result.version);

          console && console.log(result);
        } else {
          alert('QR code decoding failed');
        }
      });

      /https?:/i.test(location.protocol) && drawImage('./qrcode.jpg');

</script>
</body>
</html>